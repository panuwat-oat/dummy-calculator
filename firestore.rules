rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper function to check if user owns the document (for personal history)
    function isOwner(userId) {
      return request.auth.uid == userId;
    }

    // User Settings (Last player names)
    match /user_settings/{userId} {
      // Allow owner (Login) or public (Guest with deviceId)
      allow read, write: if true;
    }

    // Active Games (One per user)
    match /active_games/{userId} {
      // Allow owner (Login) or public (Guest with deviceId)
      allow read, write: if true;
    }

    // Game History
    match /game_history/{document=**} {
      // Allow create/read if deviceId matches (Client sends deviceId in body)
      // Since guests use random IDs, we allow writing.
      allow read, write: if true;
    }

    // Rooms (Multiplayer)
    match /rooms/{roomId} {
      // Allow anyone to read/write if they know the roomId (Public for players)
      // In production, you might want to restrict this further, but for this game, sharing ID is enough
      allow read, write: if true; 
    }
  }
}
